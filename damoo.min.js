/*! Damoo v2.0.0 | Copyright (c) 2015 James Liu | Released under the MIT license */
;(function(f){var b=function(a,c,d){if(!(this instanceof b))return new b(a,c,d);this.canvas=new h(a,c,d);this.thread=new g;this.worker=new Worker(b.path+"damoo-worker.js")};b.version="v2.0.0";b.dom=f.document;Object.defineProperty(b,"path",{get:function(){for(var a=b.dom.getElementsByTagName("script"),c=0;c<a.length;c++){var d=a[c].src,e=d.indexOf("damoo.js");if(0<e)return d.substring(0,e)}return""}});var l=function(a,c){var d=b.dom.createElement("canvas"),e=d.getContext("2d");d.width=c.size*a.text.length*
1.2;d.height=1.2*c.size;e.font=c.value;e.fillStyle="#fff";e.fillStyle=a.color;e.textAlign="start";e.textBaseline="top";e.fillText(a.text,0,0);return d},m=f.requestAnimationFrame||f.mozRequestAnimationFrame||f.webkitRequestAnimationFrame||f.msRequestAnimationFrame||f.oRequestAnimationFrame||function(a){setTimeout(a,17)};b.prototype.show=function(){this.canvas.parent.appendChild(this.canvas.layers[0]);this.canvas.parent.appendChild(this.canvas.layers[1])};b.prototype.hide=function(){this.canvas.parent.removeChild(this.canvas.layers[0]);
this.canvas.parent.removeChild(this.canvas.layers[1])};b.prototype.emit=function(a){var c=l(a,this.canvas.font),d=this;this.worker.onmessage=function(b){d.thread.push({fixed:a.fixed,canvas:c,speed:b.data.speed,offset:{x:d.canvas.width,y:b.data.oy}})};this.worker.postMessage({w:c.width,fs:this.canvas.font.size,cr:this.canvas.rows})};b.prototype.clear=function(){this.thread.empty()};b.prototype.start=function(){this.canvas.clear();for(var a=0;a<this.thread.length;a++){var c=this.thread.get(a).offset.x,
b=this.thread.get(a).offset.y;this.canvas.draw(this.thread.get(a),c,b);this.thread.get(a).offset.x-=this.thread.get(a).speed;c<=-this.thread.get(a).canvas.width&&this.thread.remove(a)}m(function(a){return function(){a.start()}}(this))};var h=function(a,c,d){this.parent=b.dom.getElementById(a);this.parent.style.position="relative";this.name=c;this.rows=d;12>this.height/this.rows&&(this.rows=this.height/12);this.width=this.parent.offsetWidth;this.height=this.parent.offsetHeight;this.font=new k(this.height/
this.rows,"sans-serif");this.layers=[b.dom.createElement("canvas"),b.dom.createElement("canvas")];this.contexts=[this.layers[0].getContext("2d"),this.layers[1].getContext("2d")];this.layers[0].className=this.layers[1].className=this.name;this.layers[0].id=Math.random().toString(16).substr(2).substr(0,6);this.layers[1].id=Math.random().toString(16).substr(2).substr(0,6);this.layers[0].width=this.layers[1].width=this.width;this.layers[0].height=this.layers[1].height=this.height;this.layers[0].style.display=
this.layers[1].style.display="block";this.layers[0].style.backgroundColor=this.layers[1].style.backgroundColor="transparent";this.layers[0].style.position=this.layers[1].style.position="absolute";this.layers[0].style.left=this.layers[1].style.left=0;this.layers[0].style.top=this.layers[1].style.top=0;this.layers[0].style.zIndex=99998;this.layers[1].style.zIndex=99999};h.prototype.clear=function(){this.contexts[0].clearRect(0,0,this.width,this.height);this.contexts[1].clearRect(0,0,this.width,this.height)};
h.prototype.draw=function(a,b,d){a.fixed?this.contexts[1].drawImage(a.canvas,(this.width-a.canvas.width)/2,d+.5|0):this.contexts[0].drawImage(a.canvas,b+.5|0,d+.5|0)};var k=function(a,b){this.size=a;this.family=b};Object.defineProperty(k.prototype,"value",{get:function(){return this.size+"px "+this.family}});var g=function(){this.pool=[]};g.prototype.push=function(a){this.pool.push(a)};g.prototype.get=function(a){return this.pool[a]};g.prototype.remove=function(a){this.pool.splice(a,1)};g.prototype.empty=
function(){this.pool=[]};Object.defineProperty(g.prototype,"length",{get:function(){return this.pool.length}});f.Damoo=b})(window);